import 'package:club_atlhetica/layers/domain/round.dart';
import 'package:club_atlhetica/layers/domain/team.dart';
import 'package:club_atlhetica/layers/service/repository/get_round_api.dart';
import 'package:club_atlhetica/layers/service/repository/get_statistic_teams_api.dart';
import 'package:club_atlhetica/layers/service/repository/model/teams_model.dart';
import 'package:club_atlhetica/layers/service/repository/repository.dart';
import 'package:club_atlhetica/layers/service/url.dart';
import 'package:club_atlhetica/layers/use_cases/get_round.dart';
import 'package:club_atlhetica/layers/use_cases/get_statistic_teams.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:mockito/annotations.dart';
import 'package:http/http.dart' as http;
import 'package:mockito/mockito.dart';

import 'get_statistic_teams_test.mocks.dart' as team;
import 'get_round_test.mocks.dart';


@GenerateMocks([http.Client])

void main() {

  final clientTeam = team.MockClient();
  final clientRound = MockClient();
  Repository repositoryTeam = GetStatisticTeamsApi(clientTeam);
  Repository repositoryRound = GetRoundApi(clientRound);
  const body = '{"get":"fixtures","parameters":{"team":"1193","season":"2022","league":"71","last":"10"},"errors":[],"results":9,"paging":{"current":1,"total":1},"response":[{"fixture":{"id":838071,"referee":"Raphael Claus, Brazil","timezone":"UTC","date":"2022-06-04T19:30:00+00:00","timestamp":1654371000,"periods":{"first":1654371000,"second":1654374600},"venue":{"id":206,"name":"Est\u00e1dio Raimundo Sampaio","city":"Belo Horizonte, Minas Gerais"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 9"},"teams":{"home":{"id":125,"name":"America Mineiro","logo":"https://media.api-sports.io/football/teams/125.png","winner":true},"away":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":false}},"goals":{"home":2,"away":1},"score":{"halftime":{"home":1,"away":1},"fulltime":{"home":2,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}},{"fixture":{"id":838069,"referee":"Wagner do Nascimento Magalhaes, Brazil","timezone":"UTC","date":"2022-05-29T21:00:00+00:00","timestamp":1653858000,"periods":{"first":1653858000,"second":1653861600},"venue":{"id":235,"name":"Arena Pantanal","city":"Cuiab\u00e1, Mato Grosso"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 8"},"teams":{"home":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":false},"away":{"id":134,"name":"Atletico Paranaense","logo":"https://media.api-sports.io/football/teams/134.png","winner":true}},"goals":{"home":0,"away":1},"score":{"halftime":{"home":0,"away":0},"fulltime":{"home":0,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}},{"fixture":{"id":838059,"referee":"Ramon Abatti","timezone":"UTC","date":"2022-05-22T00:00:00+00:00","timestamp":1653177600,"periods":{"first":1653177600,"second":1653181200},"venue":{"id":235,"name":"Arena Pantanal","city":"Cuiab\u00e1, Mato Grosso"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 7"},"teams":{"home":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":null},"away":{"id":119,"name":"Internacional","logo":"https://media.api-sports.io/football/teams/119.png","winner":null}},"goals":{"home":1,"away":1},"score":{"halftime":{"home":0,"away":0},"fulltime":{"home":1,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}},{"fixture":{"id":838043,"referee":"Alexandre Vargas Tavares de Jesus, Brazil","timezone":"UTC","date":"2022-05-15T19:00:00+00:00","timestamp":1652641200,"periods":{"first":1652641200,"second":1652644800},"venue":{"id":null,"name":"Morumb\u00ed","city":"Sao Paulo"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 6"},"teams":{"home":{"id":126,"name":"Sao Paulo","logo":"https://media.api-sports.io/football/teams/126.png","winner":true},"away":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":false}},"goals":{"home":2,"away":1},"score":{"halftime":{"home":0,"away":1},"fulltime":{"home":2,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}},{"fixture":{"id":838035,"referee":"Braulio Da Silva Machado, Brazil","timezone":"UTC","date":"2022-05-08T21:00:00+00:00","timestamp":1652043600,"periods":{"first":1652043600,"second":1652047200},"venue":{"id":10494,"name":"Est\u00e1dio Urbano Caldeira","city":"Santos, S\u00e3o Paulo"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 5"},"teams":{"home":{"id":128,"name":"Santos","logo":"https://media.api-sports.io/football/teams/128.png","winner":true},"away":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":false}},"goals":{"home":4,"away":1},"score":{"halftime":{"home":2,"away":1},"fulltime":{"home":4,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}},{"fixture":{"id":838029,"referee":"Douglas Marques das Flores, Brazil","timezone":"UTC","date":"2022-04-30T22:00:00+00:00","timestamp":1651356000,"periods":{"first":1651356000,"second":1651359600},"venue":{"id":235,"name":"Arena Pantanal","city":"Cuiab\u00e1, Mato Grosso"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 4"},"teams":{"home":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":null},"away":{"id":144,"name":"Atletico Goianiense","logo":"https://media.api-sports.io/football/teams/144.png","winner":null}},"goals":{"home":1,"away":1},"score":{"halftime":{"home":0,"away":1},"fulltime":{"home":1,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}},{"fixture":{"id":838016,"referee":"Paulo Roberto Alves Junior, Brazil","timezone":"UTC","date":"2022-04-24T21:00:00+00:00","timestamp":1650834000,"periods":{"first":1650834000,"second":1650837600},"venue":{"id":248,"name":"Est\u00e1dio Alfredo Jaconi","city":"Caxias do Sul, Rio Grande do Sul"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 3"},"teams":{"home":{"id":152,"name":"Juventude","logo":"https://media.api-sports.io/football/teams/152.png","winner":false},"away":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":true}},"goals":{"home":0,"away":1},"score":{"halftime":{"home":0,"away":0},"fulltime":{"home":0,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}},{"fixture":{"id":838009,"referee":"Savio Pereira","timezone":"UTC","date":"2022-04-17T00:00:00+00:00","timestamp":1650153600,"periods":{"first":1650153600,"second":1650157200},"venue":{"id":235,"name":"Arena Pantanal","city":"Cuiab\u00e1, Mato Grosso"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 2"},"teams":{"home":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":false},"away":{"id":124,"name":"Fluminense","logo":"https://media.api-sports.io/football/teams/124.png","winner":true}},"goals":{"home":0,"away":1},"score":{"halftime":{"home":0,"away":0},"fulltime":{"home":0,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}},{"fixture":{"id":837997,"referee":"Felipe Fernandes de Lima, Brazil","timezone":"UTC","date":"2022-04-10T21:00:00+00:00","timestamp":1649624400,"periods":{"first":1649624400,"second":1649628000},"venue":{"id":225,"name":"Est\u00e1dio Governador Pl\u00e1cido Aderaldo Castelo","city":"Fortaleza, Cear\u00e1"},"status":{"long":"Match Finished","short":"FT","elapsed":90}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https://media.api-sports.io/football/leagues/71.png","flag":"https://media.api-sports.io/flags/br.svg","season":2022,"round":"Regular Season - 1"},"teams":{"home":{"id":154,"name":"Fortaleza EC","logo":"https://media.api-sports.io/football/teams/154.png","winner":false},"away":{"id":1193,"name":"Cuiaba","logo":"https://media.api-sports.io/football/teams/1193.png","winner":true}},"goals":{"home":0,"away":1},"score":{"halftime":{"home":0,"away":1},"fulltime":{"home":0,"away":1},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}}]}';
  const bodyJson = '{"get":"fixtures","parameters":{"season":"2022","from":"2022-06-02","to":"2022-06-08","league":"71"},"errors":[],"results":15,"paging":{"current":1,"total":1},"response":[{"fixture":{"id":838071,"referee":"Raphael Claus","timezone":"UTC","date":"2022-06-04T10:40:00+00:00","timestamp":1654371000,"periods":{"first":null,"second":null},"venue":{"id":206,"name":"Est\u00e1dio Raimundo Sampaio","city":"Belo Horizonte, Minas Gerais"},"status":{"long":"Not Started","short":"NS","elapsed":null}},"league":{"id":71,"name":"Serie A","country":"Brazil","logo":"https:\/\/media.api-sports.io\/football\/leagues\/71.png","flag":"https:\/\/media.api-sports.io\/flags\/br.svg","season":2022,"round":"Regular Season - 9"},"teams":{"home":{"id":125,"name":"America Mineiro","logo":"https:\/\/media.api-sports.io\/football\/teams\/125.png","winner":null},"away":{"id":1193,"name":"Cuiaba","logo":"https:\/\/media.api-sports.io\/football\/teams\/1193.png","winner":null}},"goals":{"home":null,"away":null},"score":{"halftime":{"home":null,"away":null},"fulltime":{"home":null,"away":null},"extratime":{"home":null,"away":null},"penalty":{"home":null,"away":null}}}]}';


  test('Get id team', ()async{
   when(clientRound.get(Uri.parse(urlAllNextRound), headers: headers)).thenAnswer((_) async => http.Response(bodyJson, 200));
   GetRound getRound = GetRound(repository: repositoryRound);
   Round round = await getRound.execute(0);
   when(clientTeam.get(Uri.parse(setUrlTeams(round.home)), headers: headers)).thenAnswer((_) async => http.Response(body, 200));
   GetStatisticTeams getStatisticTeams = GetStatisticTeams(repositoryTeam);
   List<SoccerMatch> team = await getStatisticTeams.execute(round.home);
   expect(team[0].teams?.home?.id, 125);
   expect(team[0].goals?.home, 2);
  });
}